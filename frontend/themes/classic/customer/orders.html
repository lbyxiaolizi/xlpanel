{{define "content"}}
<div class="bg-white rounded-xl shadow-sm border border-gray-200 p-8">
    <div class="mb-6">
        <h2 class="text-2xl font-bold text-gray-900">{{.T "orders.title"}}</h2>
        <p class="mt-2 text-sm text-gray-600">
            {{if eq .Lang "zh"}}查看您的所有订单{{else}}View all your orders{{end}}
        </p>
    </div>

    <!-- Orders List -->
    <div id="ordersContainer">
        <p class="text-center text-gray-500 py-8">{{.T "msg.loading"}}</p>
    </div>
</div>

<script>
async function loadOrders() {
    const token = localStorage.getItem('token');
    if (!token) {
        window.location.href = '/login';
        return;
    }

    try {
        const response = await fetch('/orders', {
            headers: {
                'Authorization': 'Bearer ' + token
            }
        });
        
        if (response.ok) {
            const orders = await response.json();
            renderOrders(orders);
        } else {
            document.getElementById('ordersContainer').innerHTML = '<p class="text-center text-gray-500 py-8">{{.T "msg.error"}}</p>';
        }
    } catch (error) {
        console.error('Error loading orders:', error);
        document.getElementById('ordersContainer').innerHTML = '<p class="text-center text-gray-500 py-8">{{.T "msg.error"}}</p>';
    }
}

function renderOrders(orders) {
    const container = document.getElementById('ordersContainer');
    
    if (!orders || orders.length === 0) {
        container.innerHTML = `
            <div class="text-center py-12">
                <i class="fas fa-inbox text-6xl text-gray-300 mb-4"></i>
                <p class="text-xl text-gray-600 mb-4">{{.T "msg.no_data"}}</p>
                <a href="/customer/products" class="inline-block bg-blue-600 text-white px-6 py-3 rounded-md hover:bg-blue-700 transition-colors">
                    {{.T "products.select"}}
                </a>
            </div>
        `;
        return;
    }

    let html = '<div class="overflow-x-auto">';
    html += '<table class="min-w-full divide-y divide-gray-200">';
    html += `
        <thead class="bg-gray-50">
            <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">{{.T "orders.order_id"}}</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">{{if eq .Lang "zh"}}产品{{else}}Product{{end}}</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">{{.T "cart.quantity"}}</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">{{.T "orders.status"}}</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">{{.T "orders.date"}}</th>
            </tr>
        </thead>
    `;
    html += '<tbody class="bg-white divide-y divide-gray-200">';
    
    orders.forEach(order => {
        const statusColor = order.status === 'completed' ? 'green' : 
                          order.status === 'pending' ? 'yellow' : 
                          order.status === 'cancelled' ? 'red' : 'gray';
        
        html += `
            <tr class="hover:bg-gray-50">
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                    ${order.id.substring(0, 8)}...
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                    ${order.product_code}
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                    ${order.quantity}
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <span class="inline-flex px-3 py-1 text-xs font-medium rounded-full bg-${statusColor}-100 text-${statusColor}-800">
                        ${order.status}
                    </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                    ${new Date(order.created_at).toLocaleDateString()}
                </td>
            </tr>
        `;
    });
    
    html += '</tbody></table></div>';
    container.innerHTML = html;
}

// Load orders on page load
loadOrders();
</script>
{{end}}
